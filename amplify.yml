version: 1
frontend:
  phases:
    preBuild:
      commands:
        - gem install bundler
        - bundle config set path 'vendor/bundle'
        - bundle install
    build:
      commands:
        - npm run build || aws sns publish --topic-arn $SNS_TOPIC_ARN_FAILURE --message "Amplify build failed"
    postBuild:
      commands:
        - aws sns publish --topic-arn $SNS_TOPIC_ARN_SUCCESS --message "Amplify build succeeded"
  artifacts:
    baseDirectory: _site
    files:
      - "**/*"
  cache:
    paths:
      - vendor/bundle/**/*
      - Gemfile.lock
      - node_modules
  notifications:
    - type: SNS
      topicArn: $SNS_TOPIC_ARN_SUCCESS
      event: "BUILD_SUCCESS"
    - type: SNS
      topicArn: $SNS_TOPIC_ARN_FAILURE
      event: "BUILD_FAILURE"
